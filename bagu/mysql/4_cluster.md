# 集群


## 一主多从



### 同步方式

relaylog

- 异步: (默认方式)
    主库不等待从库ack就返回，写入binlog后就commit然后返回，由后台线程将binlog变更推送给从库, 从库的io线程读取数据写入relaylog，再由sql-thread执行数据的变更
- 全同步: 主库执行了事务，所有从库都同步完成再返回给客户端，性能影响很大，几乎不用
- 半同步: 介于异步和全同步之间，等待至少一个从库写入relaylog，然后ack就commit (最主流，通过插件实现)
    - 5.5 after commit 不完美
    - 5.7 after sync 进行了优化
半同步还会限制同步的时间，超过这个时间还没有收到ack就降级为异步复制
一致性和可用性的折中之举，仍然会丢失数据


### 主从延迟

数据库层面优化：
- 敏感业务强制读主库
- 写后短时间内读主库，过了一段时间后读从库

但从架构层面还有优的方案

## 主主模式
两台服务器互为主从
TODO 


## 高可用架构
TODO 
### MMM

### MHA

### QMHA

### PXC/MGR